import{r as l,j as e,a as v,R as T,c as F}from"./index-DPEWr26x.js";const I=({show:i,onClose:h,term:m,teacherCode:d,teacherName:b})=>{const[g,x]=l.useState([]),[j,u]=l.useState(!1),[n,o]=l.useState(null);return l.useEffect(()=>{(async()=>{if(!(!i||!m||!d)){u(!0),o(null);try{const r=await v.get(`/api/reports/TeacherChanges/${m}/${d}`);x(r)}catch(r){o(r.message)}finally{u(!1)}}})()},[i,m,d]),i?e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",role:"dialog",children:e.jsx("div",{className:"modal-dialog modal-lg",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:["تغییرات استاد: ",b," ",e.jsxs("span",{className:"text-muted",children:["(",d,")"]})]}),e.jsx("button",{type:"button",className:"btn-close",onClick:h})]}),e.jsxs("div",{className:"modal-body",children:[j&&e.jsx("p",{children:"در حال بارگذاری..."}),n&&e.jsx("div",{className:"alert alert-danger",children:n}),g.length>0?e.jsxs("table",{className:"table table-sm table-bordered table-striped",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"ستون تغییر یافته"}),e.jsx("th",{children:"مقدار قبلی"}),e.jsx("th",{children:"مقدار جدید"}),e.jsx("th",{children:"توسط"}),e.jsx("th",{children:"زمان تغییر"})]})}),e.jsx("tbody",{children:g.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:c.columnName}),e.jsx("td",{children:c.oldValue}),e.jsx("td",{children:c.newValue}),e.jsx("td",{children:c.changedBy}),e.jsx("td",{children:new Date(c.changedAt).toLocaleString("fa-IR")})]},c.id))})]}):!j&&e.jsx("p",{children:"هیچ تغییری یافت نشد."})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:h,children:"بستن"})})]})})}):null},A=({term:i,cooperationType:h,completed:m})=>{const[d,b]=l.useState([]),[g,x]=l.useState(!1),[j,u]=l.useState(null),[n,o]=l.useState(1),c=30,[r,N]=l.useState({key:"lname",direction:"asc"}),[y,t]=l.useState(!1),[p,M]=l.useState(null),[S,R]=l.useState("");l.useEffect(()=>{(async()=>{if(!(!i||!h)){x(!0),u(null);try{const a=await v.get(`/api/reports/TeachersByCooperation/${i}/${h}/${m}`);b(a),o(1)}catch(a){u(a.message)}finally{x(!1)}}})()},[i,h,m]);const w=T.useMemo(()=>d.filter(s=>{const a=S.toLowerCase();return s.code.toLowerCase().includes(a)||s.fname.toLowerCase().includes(a)||s.lname.toLowerCase().includes(a)}),[d,S]),$=T.useMemo(()=>{let s=[...w];return r!==null&&s.sort((a,k)=>a[r.key]<k[r.key]?r.direction==="asc"?-1:1:a[r.key]>k[r.key]?r.direction==="asc"?1:-1:0),s},[w,r]),L=(n-1)*c,D=$.slice(L,L+c),C=Math.ceil($.length/c),f=s=>{let a="asc";r.key===s&&r.direction==="asc"&&(a="desc"),N({key:s,direction:a})},P=s=>{M(s),t(!0)};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("h5",{children:["لیست اساتید (",h,") -"," که فرم حضور هفتگی را  ",m?"تکمیل کرده‌اند":"تکمیل نکرده‌اند"]}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"جستجو بر اساس کد، نام یا نام خانوادگی...",value:S,onChange:s=>R(s.target.value)})}),g&&e.jsx("p",{children:"در حال بارگذاری..."}),j&&e.jsx("div",{className:"alert alert-danger",children:j}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"table table-sm table-bordered",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>f("code"),children:"کد"}),e.jsx("th",{onClick:()=>f("fname"),children:"نام"}),e.jsx("th",{onClick:()=>f("lname"),children:"نام خانوادگی"}),e.jsx("th",{onClick:()=>f("mobile"),children:"موبایل"}),e.jsx("th",{onClick:()=>f("centerTitle"),children:"مرکز"}),e.jsx("th",{onClick:()=>f("cooperationType"),children:"نوع همکاری"}),e.jsx("th",{children:"مشاهده تغییرات"})]})}),e.jsx("tbody",{children:D.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.code}),e.jsx("td",{children:s.fname}),e.jsx("td",{children:s.lname}),e.jsx("td",{children:s.mobile}),e.jsx("td",{children:s.centerTitle}),e.jsx("td",{children:s.cooperationType}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-info",onClick:()=>P(s),children:"مشاهده تغییرات"})})]},s.code))})]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination justify-content-center",children:[e.jsx("li",{className:`page-item ${n===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>o(n-1),disabled:n===1,children:"قبلی"})}),Array.from({length:C},(s,a)=>a+1).filter(s=>s===1||s===C||s>=n-2&&s<=n+2).map((s,a,k)=>{const E=k[a-1],B=E&&s-E>1;return e.jsxs(T.Fragment,{children:[B&&e.jsx("li",{className:"page-item disabled",children:e.jsx("span",{className:"page-link",children:"…"})}),e.jsx("li",{className:`page-item ${n===s?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>o(s),children:s})})]},s)}),e.jsx("li",{className:`page-item ${n===C?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>o(n+1),disabled:n===C,children:"بعدی"})})]})})]}),y&&p&&e.jsx(I,{show:y,onClose:()=>t(!1),term:i,teacherCode:p.code,teacherName:`${p.fname} ${p.lname}`})]})},W=()=>{const{selectedTerm:i,setSelectedTerm:h,allTerms:m,loading:d}=F(),[b,g]=l.useState([]),[x,j]=l.useState(!1),[u,n]=l.useState(null),[o,c]=l.useState(null),[r,N]=l.useState(null),y=async()=>{j(!0),n(null);try{const t=await v.get(`/api/reports/WeeklyChangesByTerm/${i}`);g(t)}catch(t){n(t.message),console.error(t)}finally{j(!1)}};return d?e.jsx("p",{children:"در حال بارگذاری لیست ترم‌ها..."}):e.jsxs("div",{className:"container my-4",children:[e.jsx("h3",{className:"mb-3",children:"گزارش تغییرات برنامه هفتگی اساتید"}),e.jsxs("div",{className:"d-flex align-items-center mb-3 gap-2",children:[e.jsx("label",{children:"نیمسال مورد نظر را انتخاب کنید"}),e.jsx("select",{className:"form-select form-select-md",style:{width:"150px"},value:i||"",onChange:t=>h(t.target.value),children:m.map(t=>e.jsx("option",{value:t.term,children:t.term},t.term))}),e.jsx("button",{className:"btn btn-md btn-primary",onClick:y,disabled:x||!i,children:x?"در حال جستجو...":"جستجو"})]}),u&&e.jsx("div",{className:"alert alert-danger",children:u}),e.jsx("div",{children:b.length>0?e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{className:"table-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"نوع همکاری"}),e.jsx("th",{children:"تعداد تغییر داده"}),e.jsx("th",{children:"تعداد کل اساتید"}),e.jsx("th",{children:"عملیات"})]})}),e.jsx("tbody",{children:b.map((t,p)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.cooperationType}),e.jsx("td",{children:t.changedCount}),e.jsx("td",{children:t.totalCount}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-info",onClick:()=>{c(t.cooperationType),N(!0)},children:"مشاهده تکمیل کرده‌اند"}),e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>{c(t.cooperationType),N(!1)},children:"مشاهده تکمیل نکرده‌اند"})]})})]},p))})]}):!x&&e.jsx("p",{children:"هنوز گزارشی برای نمایش وجود ندارد."})}),o&&e.jsx(A,{term:i,cooperationType:o,completed:r})]})};export{W as default};
