import{r as a,j as e,a as v,b as F,R as T,c as I}from"./index-CuiF2JwL.js";const W=({show:d,onClose:h,term:m,teacherCode:i,teacherName:b})=>{const[g,x]=a.useState([]),[j,u]=a.useState(!1),[n,o]=a.useState(null);return a.useEffect(()=>{(async()=>{if(!(!d||!m||!i)){u(!0),o(null);try{const r=await v.get(`/api/reports/TeacherChanges/${m}/${i}`);x(r)}catch(r){o(r.message)}finally{u(!1)}}})()},[d,m,i]),d?e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",role:"dialog",children:e.jsx("div",{className:"modal-dialog modal-lg",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:["تغییرات استاد: ",b," ",e.jsxs("span",{className:"text-muted",children:["(",i,")"]})]}),e.jsx("button",{type:"button",className:"btn-close",onClick:h})]}),e.jsxs("div",{className:"modal-body",children:[j&&e.jsx("p",{children:"در حال بارگذاری..."}),n&&e.jsx("div",{className:"alert alert-danger",children:n}),g.length>0?e.jsxs("table",{className:"table table-sm table-bordered table-striped",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"روز هفته"}),e.jsx("th",{children:"ستون تغییر یافته"}),e.jsx("th",{children:"مقدار قبلی"}),e.jsx("th",{children:"مقدار جدید"}),e.jsx("th",{children:"توسط"}),e.jsx("th",{children:"زمان تغییر"})]})}),e.jsx("tbody",{children:g.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:c.dayOfWeek}),e.jsx("td",{children:c.columnName}),e.jsx("td",{children:c.oldValue}),e.jsx("td",{children:c.newValue}),e.jsx("td",{children:c.changedBy}),e.jsx("td",{children:new Date(c.changedAt).toLocaleString("fa-IR")})]},c.id))})]}):!j&&e.jsx("p",{children:"هیچ تغییری یافت نشد."})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:h,children:"بستن"})})]})})}):null},O=({term:d,cooperationType:h,completed:m})=>{const[i,b]=a.useState([]),[g,x]=a.useState(!1),[j,u]=a.useState(null),[n,o]=a.useState(1),c=30,[r,N]=a.useState({key:"lname",direction:"asc"}),[y,t]=a.useState(!1),[f,M]=a.useState(null),[S,D]=a.useState(""),{hasRole:w,loading:V}=F();a.useEffect(()=>{(async()=>{if(!(!d||!h)){x(!0),u(null);try{const l=await v.get(`/api/reports/TeachersByCooperation/${d}/${h}/${m}`);b(l),o(1)}catch(l){u(l.message)}finally{x(!1)}}})()},[d,h,m]);const $=T.useMemo(()=>i.filter(s=>{const l=S.toLowerCase();return s.code.toLowerCase().includes(l)||s.fname.toLowerCase().includes(l)||s.lname.toLowerCase().includes(l)}),[i,S]),L=T.useMemo(()=>{let s=[...$];return r!==null&&s.sort((l,k)=>l[r.key]<k[r.key]?r.direction==="asc"?-1:1:l[r.key]>k[r.key]?r.direction==="asc"?1:-1:0),s},[$,r]),R=(n-1)*c,P=L.slice(R,R+c),C=Math.ceil(L.length/c),p=s=>{let l="asc";r.key===s&&r.direction==="asc"&&(l="desc"),N({key:s,direction:l})},A=s=>{M(s),t(!0)};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("h5",{children:["لیست اساتید (",h,") -"," که فرم حضور هفتگی را  ",m?"تکمیل کرده‌اند":"تکمیل نکرده‌اند"]}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"جستجو بر اساس کد، نام یا نام خانوادگی...",value:S,onChange:s=>D(s.target.value)})}),g&&e.jsx("p",{children:"در حال بارگذاری..."}),j&&e.jsx("div",{className:"alert alert-danger",children:j}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"table table-sm table-bordered",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>p("code"),children:"کد"}),e.jsx("th",{onClick:()=>p("fname"),children:"نام"}),e.jsx("th",{onClick:()=>p("lname"),children:"نام خانوادگی"}),e.jsx("th",{onClick:()=>p("mobile"),children:"موبایل"}),e.jsx("th",{onClick:()=>p("centerTitle"),children:"مرکز"}),e.jsx("th",{onClick:()=>p("cooperationType"),children:"نوع همکاری"}),e.jsx("th",{children:"مشاهده تغییرات"})]})}),e.jsx("tbody",{children:P.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.code}),e.jsx("td",{children:s.fname}),e.jsx("td",{children:s.lname}),e.jsx("td",{children:s.mobile}),e.jsx("td",{children:s.centerTitle}),e.jsx("td",{children:s.cooperationType}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-info",onClick:()=>A(s),disabled:!(w("admin")||w("centerAdmin")),children:"مشاهده تغییرات"})})]},s.code))})]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination justify-content-center",children:[e.jsx("li",{className:`page-item ${n===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>o(n-1),disabled:n===1,children:"قبلی"})}),Array.from({length:C},(s,l)=>l+1).filter(s=>s===1||s===C||s>=n-2&&s<=n+2).map((s,l,k)=>{const E=k[l-1],B=E&&s-E>1;return e.jsxs(T.Fragment,{children:[B&&e.jsx("li",{className:"page-item disabled",children:e.jsx("span",{className:"page-link",children:"…"})}),e.jsx("li",{className:`page-item ${n===s?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>o(s),children:s})})]},s)}),e.jsx("li",{className:`page-item ${n===C?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>o(n+1),disabled:n===C,children:"بعدی"})})]})})]}),y&&f&&e.jsx(W,{show:y,onClose:()=>t(!1),term:d,teacherCode:f.code,teacherName:`${f.fname} ${f.lname}`})]})},z=()=>{const{selectedTerm:d,setSelectedTerm:h,allTerms:m,loading:i}=I(),[b,g]=a.useState([]),[x,j]=a.useState(!1),[u,n]=a.useState(null),[o,c]=a.useState(null),[r,N]=a.useState(null),y=async()=>{j(!0),n(null);try{const t=await v.get(`/api/reports/WeeklyChangesByTerm/${d}`);g(t)}catch(t){n(t.message),console.error(t)}finally{j(!1)}};return i?e.jsx("p",{children:"در حال بارگذاری لیست ترم‌ها..."}):e.jsxs("div",{className:"container my-4",children:[e.jsx("h3",{className:"mb-3",children:"گزارش تغییرات برنامه هفتگی اساتید"}),e.jsxs("div",{className:"d-flex align-items-center mb-3 gap-2",children:[e.jsx("label",{children:"نیمسال مورد نظر را انتخاب کنید"}),e.jsx("select",{className:"form-select form-select-md",style:{width:"150px"},value:d||"",onChange:t=>h(t.target.value),children:m.map(t=>e.jsx("option",{value:t.term,children:t.term},t.term))}),e.jsx("button",{className:"btn btn-md btn-primary",onClick:y,disabled:x||!d,children:x?"در حال جستجو...":"جستجو"})]}),u&&e.jsx("div",{className:"alert alert-danger",children:u}),e.jsx("div",{children:b.length>0?e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{className:"table-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"نوع همکاری"}),e.jsx("th",{children:"تعداد تغییر داده"}),e.jsx("th",{children:"تعداد کل اساتید"}),e.jsx("th",{children:"عملیات"})]})}),e.jsx("tbody",{children:b.map((t,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.cooperationType}),e.jsx("td",{children:t.changedCount}),e.jsx("td",{children:t.totalCount}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-info",onClick:()=>{c(t.cooperationType),N(!0)},children:"مشاهده تکمیل کرده‌اند"}),e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>{c(t.cooperationType),N(!1)},children:"مشاهده تکمیل نکرده‌اند"})]})})]},f))})]}):!x&&e.jsx("p",{children:"هنوز گزارشی برای نمایش وجود ندارد."})}),o&&e.jsx(O,{term:d,cooperationType:o,completed:r})]})};export{z as default};
