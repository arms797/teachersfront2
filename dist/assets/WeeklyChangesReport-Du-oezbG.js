import{r as l,j as e,a as S,R as $,c as D}from"./index-CDtw8VYz.js";const I=({show:c,onClose:i,term:o,teacherCode:d,teacherName:g})=>{const[b,h]=l.useState([]),[x,m]=l.useState(!1),[j,u]=l.useState(null);return l.useEffect(()=>{(async()=>{if(!(!c||!o||!d)){m(!0),u(null);try{const n=await S.get(`/api/reports/TeacherChanges/${o}/${d}`);h(n)}catch(n){u(n.message)}finally{m(!1)}}})()},[c,o,d]),c?e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",role:"dialog",children:e.jsx("div",{className:"modal-dialog modal-lg",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:["تغییرات استاد: ",g," ",e.jsxs("span",{className:"text-muted",children:["(",d,")"]})]}),e.jsx("button",{type:"button",className:"btn-close",onClick:i})]}),e.jsxs("div",{className:"modal-body",children:[x&&e.jsx("p",{children:"در حال بارگذاری..."}),j&&e.jsx("div",{className:"alert alert-danger",children:j}),b.length>0?e.jsxs("table",{className:"table table-sm table-bordered table-striped",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"ستون تغییر یافته"}),e.jsx("th",{children:"مقدار قبلی"}),e.jsx("th",{children:"مقدار جدید"}),e.jsx("th",{children:"توسط"}),e.jsx("th",{children:"زمان تغییر"})]})}),e.jsx("tbody",{children:b.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.columnName}),e.jsx("td",{children:r.oldValue}),e.jsx("td",{children:r.newValue}),e.jsx("td",{children:r.changedBy}),e.jsx("td",{children:new Date(r.changedAt).toLocaleString("fa-IR")})]},r.id))})]}):!x&&e.jsx("p",{children:"هیچ تغییری یافت نشد."})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:i,children:"بستن"})})]})})}):null},P=({term:c,cooperationType:i,completed:o})=>{const[d,g]=l.useState([]),[b,h]=l.useState(!1),[x,m]=l.useState(null),[j,u]=l.useState(1),r=30,[n,N]=l.useState({key:"lname",direction:"asc"}),[y,t]=l.useState(!1),[p,L]=l.useState(null),[C,E]=l.useState("");l.useEffect(()=>{(async()=>{if(!(!c||!i)){h(!0),m(null);try{const a=await S.get(`/api/reports/TeachersByCooperation/${c}/${i}/${o}`);g(a),u(1)}catch(a){m(a.message)}finally{h(!1)}}})()},[c,i,o]);const T=$.useMemo(()=>d.filter(s=>{const a=C.toLowerCase();return s.code.toLowerCase().includes(a)||s.fname.toLowerCase().includes(a)||s.lname.toLowerCase().includes(a)}),[d,C]),k=$.useMemo(()=>{let s=[...T];return n!==null&&s.sort((a,w)=>a[n.key]<w[n.key]?n.direction==="asc"?-1:1:a[n.key]>w[n.key]?n.direction==="asc"?1:-1:0),s},[T,n]),v=(j-1)*r,M=k.slice(v,v+r),R=Math.ceil(k.length/r),f=s=>{let a="asc";n.key===s&&n.direction==="asc"&&(a="desc"),N({key:s,direction:a})},B=s=>{L(s),t(!0)};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("h5",{children:["لیست اساتید (",i,") -"," که فرم حضور هفتگی را  ",o?"تکمیل کرده‌اند":"تکمیل نکرده‌اند"]}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"جستجو بر اساس کد، نام یا نام خانوادگی...",value:C,onChange:s=>E(s.target.value)})}),b&&e.jsx("p",{children:"در حال بارگذاری..."}),x&&e.jsx("div",{className:"alert alert-danger",children:x}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"table table-sm table-bordered",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>f("code"),children:"کد"}),e.jsx("th",{onClick:()=>f("fname"),children:"نام"}),e.jsx("th",{onClick:()=>f("lname"),children:"نام خانوادگی"}),e.jsx("th",{onClick:()=>f("mobile"),children:"موبایل"}),e.jsx("th",{onClick:()=>f("centerTitle"),children:"مرکز"}),e.jsx("th",{onClick:()=>f("cooperationType"),children:"نوع همکاری"}),e.jsx("th",{children:"مشاهده تغییرات"})]})}),e.jsx("tbody",{children:M.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.code}),e.jsx("td",{children:s.fname}),e.jsx("td",{children:s.lname}),e.jsx("td",{children:s.mobile}),e.jsx("td",{children:s.centerTitle}),e.jsx("td",{children:s.cooperationType}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-info",onClick:()=>B(s),children:"مشاهده تغییرات"})})]},s.code))})]}),e.jsx("nav",{children:e.jsx("ul",{className:"pagination",children:Array.from({length:R},(s,a)=>e.jsx("li",{className:`page-item ${j===a+1?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>u(a+1),children:a+1})},a))})})]}),y&&p&&e.jsx(I,{show:y,onClose:()=>t(!1),term:c,teacherCode:p.code,teacherName:`${p.fname} ${p.lname}`})]})},F=()=>{const{selectedTerm:c,setSelectedTerm:i,allTerms:o,loading:d}=D(),[g,b]=l.useState([]),[h,x]=l.useState(!1),[m,j]=l.useState(null),[u,r]=l.useState(null),[n,N]=l.useState(null),y=async()=>{x(!0),j(null);try{const t=await S.get(`/api/reports/WeeklyChangesByTerm/${c}`);b(t)}catch(t){j(t.message),console.error(t)}finally{x(!1)}};return d?e.jsx("p",{children:"در حال بارگذاری لیست ترم‌ها..."}):e.jsxs("div",{className:"container my-4",children:[e.jsx("h3",{className:"mb-3",children:"گزارش تغییرات برنامه هفتگی اساتید"}),e.jsxs("div",{className:"d-flex align-items-center mb-3 gap-2",children:[e.jsx("label",{children:"نیمسال مورد نظر را انتخاب کنید"}),e.jsx("select",{className:"form-select form-select-md",style:{width:"150px"},value:c||"",onChange:t=>i(t.target.value),children:o.map(t=>e.jsx("option",{value:t.term,children:t.term},t.term))}),e.jsx("button",{className:"btn btn-md btn-primary",onClick:y,disabled:h||!c,children:h?"در حال جستجو...":"جستجو"})]}),m&&e.jsx("div",{className:"alert alert-danger",children:m}),e.jsx("div",{children:g.length>0?e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{className:"table-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"نوع همکاری"}),e.jsx("th",{children:"تعداد تغییر داده"}),e.jsx("th",{children:"تعداد کل اساتید"}),e.jsx("th",{children:"عملیات"})]})}),e.jsx("tbody",{children:g.map((t,p)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.cooperationType}),e.jsx("td",{children:t.changedCount}),e.jsx("td",{children:t.totalCount}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-info",onClick:()=>{r(t.cooperationType),N(!0)},children:"مشاهده تکمیل کرده‌اند"}),e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>{r(t.cooperationType),N(!1)},children:"مشاهده تکمیل نکرده‌اند"})]})})]},p))})]}):!h&&e.jsx("p",{children:"هنوز گزارشی برای نمایش وجود ندارد."})}),u&&e.jsx(P,{term:c,cooperationType:u,completed:n})]})};export{F as default};
